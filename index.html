<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>人口金字塔绘制</title>
<meta name="description" content="">
<meta name="keywords" content="">
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="echarts.min.js"></script>
<script src="layui/layui.js"></script>
<link rel="stylesheet" type="text/css" href="layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="./custom.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

</head>
<body>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;">
	  <legend>设置</legend>
	</fieldset>
	<form class="layui-form " action="" id="form">
	  <div class="layui-form-item">
		  	<div class="layui-inline">
			    <label class="layui-form-label">标题</label>
			    <div class="layui-input-inline">
			      <input type="text" name="title" id="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
			    </div>
			</div>
			  <div class="layui-inline">
			    <label class="layui-form-label">副标题</label>
			    <div class="layui-input-inline">
			      <input type="text" name="subtitle" id="subtitle" placeholder="请输入" autocomplete="off" class="layui-input">
			    </div>
			  </div>
			  <div class="layui-inline">
			    <label class="layui-form-label">副标题链接</label>
			    <div class="layui-input-inline">
			      <input type="text" name="sublink" id="sublink" placeholder="请输入" autocomplete="off" class="layui-input">
			    </div>
			  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">宽度</label>
	    <div class="layui-input-block">
	      	<div id="sliderw"></div>
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">高度</label>
	    <div class="layui-input-block">
			<div id="sliderh"></div>
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">平滑</label>
	    <div class="layui-input-block">
	      <input type="checkbox" checked="" name="smooth" lay-skin="switch" lay-filter="switch-smooth" lay-text="开启|关闭">
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">标签</label>
	    <div class="layui-input-block">
	      <input type="checkbox" checked="" name="label" lay-skin="switch" lay-filter="switch-label" lay-text="开启|关闭">
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">类型</label>
	    <div class="layui-input-block">
	      <input type="radio" name="gtype" lay-filter="gtype" value="bar" title="Bar" checked="">
	      <input type="radio" name="gtype" lay-filter="gtype" value="line" title="Line">
	      <input type="radio" name="gtype" lay-filter="gtype" value="禁" title="禁用" disabled="">
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">透明度</label>
	    <div class="layui-input-block">
			<div id="slidero"></div>
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">刻度线Y</label>
	    <div class="layui-input-block">
			<div id="slideryaxis"></div>
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">颜色1</label>
	    <div class="layui-input-block">
			<div id="color1"></div>
	    </div>
	  </div>
	  <div class="layui-inline">
	    <label class="layui-form-label">颜色2</label>
	    <div class="layui-input-block">
			<div id="color2"></div>
	    </div>
	  </div>
	  <button type="button" class="layui-btn" id="uploadBtn">
		  <i class="layui-icon">&#xe67c;</i>上传文件
	  </button>
	  <div class="layui-inline">
	    <div class="layui-input-block">
	      <button class="layui-btn" lay-submit="" lay-filter="ok" id="ok">确定</button>
	      <button type="reset" class="layui-btn layui-btn-primary" lay-filter="reset" id="reset">重置</button>
	    </div>
	  </div>
  </div>
	</form>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;">
	  <legend>效果</legend>
	</fieldset>
    <div id="main" style="width: 800px;height:600px;"></div>
<script>
    function setPri(obj) {
    	var myChart = echarts.init(document.getElementById('main'));
    	myChart.width = obj.width;
    	myChart.height = obj.height;
		var option = {
			toolbox: {
		        show: true,
		        feature: {
		            dataZoom: {
		                yAxisIndex: 'none'
		            },
		            dataView: {readOnly: true},
		            magicType: {type: ['line', 'bar']},
		            restore: {},
		            saveAsImage: {}
		        },
		        orient:'vertical',
		    },
			title:{
				text:obj.title,
				subtext:obj.subtitle,
				sublink:obj.sublink,
				subtarget:'blank',
				subtextStyle:{
					color:'#aaa',
					fontStyle :'normal',
					fontSize :12,
					algin:'center',
				},

			},
		    tooltip : {
		        trigger: 'axis',
		        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
		            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
		        },
		    },
		    legend: {
		        data:['男性', '女性']
		    },
		    grid: {
		        left: '3%',
		        right: '4%',
		        bottom: '3%',
		        containLabel: true
		    },
		    dataset: {
		        source: [
		            ['年龄', '男性', '女性'],
					['0-4',-41062566,34470044],
					['5-9',-38464665,32416884],
					['10-14',-40267277,34641185],
					['15-19',-51904830,47984284],
					['20-24',-64008573,63403945],
					['25-29',-50837038,50176814],
					['30-34',-49521822,47616381],
					['35-39',-60391104,57634855],
					['40-44',-63608678,61145286],
					['45-49',-53776418,51818135],
					['50-54',-40363234,38389937],
					['55-59',-41082938,40229536],
					['60-64',-29834426,28832856],
					['65-69',-20748471,20364811],
					['70-74',-16403453,16568944],
					['75-79',-11278859,12573274],
					['80-84',-5917502,7455696],
					['85-89',-2199810,3432118],
					['90-94',-530872,1047435],
					['95-99',-117716,252263],
					['100+',-8852,27082],
		        ]
		    },
		    xAxis : [
		        {
		            name:"数量",
		            nameLocation:"center",
		            nameGap:25,
		            nameRotate:0,
		            // inverse:true,
		            axisLine:{
		            	symbol:"arrow",//坐标轴箭头
		            	symbolSize:"5",//坐标轴箭头大小
		            	lineStyle:{	//坐标轴线段设置
		            		color:"#333",//颜色
			            	width:2,//坐标轴线段宽度
			            },
		            },
		            axisLabel:{
		            	formatter: function (value, index) {
						    return numeral(Math.abs(value)).format('0,0');
						}
		            },
		            splitLine:{
		            	lineStyle:{
		            		color:"#ccc",//颜色
			            	width:1,
			            },
		            },  
		        }
		    ],
		    yAxis : [
		        {
		        	name:"年龄段",
		            type : 'category',
		            nameLocation:"middle",
		            nameGap:50,
		            nameRotate:90,
		            // inverse:true,//是否反向坐标轴
		            axisLine:{
		            	lineStyle:{	//坐标轴线段设置
		            		color:"#333",//颜色
			            	width:1,//坐标轴线段宽度
			            },
		            },
		            axisTick:{
		            	alignWithLabel:false,
		            	length:obj.axisTick_length,
		            },
		            boundaryGap:true,
		        }
		    ],
		    series : [
		        {
		            name:'男性',
		            type:obj.gtype,
		            smooth:obj.smooth,
		            stack: '年龄',
		            label: {
	                    show: obj.label,// 是否显示标签值
	                    position: 'left', //显示位置
	                    formatter: function (data) {
						      return numeral(Math.abs(data.data[1])).format('0,0');
						},
						color:"#6f6f6f",
		            },
		            itemStyle:{
		            	color:obj.color_male,
		            },
		            areaStyle:{
		            	color:obj.color_male,
		            	opacity:obj.area_opacity,
		            },

		        },
		        {
		            name:'女性',
		            type:obj.gtype,
		            smooth:obj.smooth,
		            stack: '年龄',
		            label: {
	                    show: obj.label,// 是否显示标签值
	                    position: 'right', //显示位置
	                    color:"#6f6f6f",
	                    formatter: function (data) {
						      return numeral(Math.abs(data.data[2])).format('0,0');
						},
		            },
		            itemStyle:{
		            	color:obj.color_female, //设置颜色
		            },
		            areaStyle:{
		            	color:obj.color_female,
		            	opacity:obj.area_opacity,
		            },
		        }
		    ]
		};
	    myChart.setOption(option);
    }
    function setPriW(width) {
    	var myChart = echarts.init(document.getElementById('main'));
	    myChart.resize(width);
    }
    function setPriH(height) {
    	var myChart = echarts.init(document.getElementById('main'));
	    myChart.resize(height);
    }
</script>
<script>
	$(document).ready(function() {
		layui.use(['layer', 'form', 'slider','colorpicker','upload'], function(){
	    var layer = layui.layer
	    ,form = layui.form
	    ,slider = layui.slider
	    ,colorpicker = layui.colorpicker
	    ,upload = layui.upload;
	  	
	    var obj = {
			width:600,
			height:400,
			title:"标题",
			subtitle:"副标题",
			sublink:"副标题链接",
			smooth:true,
			label:true,
			area_opacity:0.7,
			axisTick_length:5,
			color_male:'#20b7a9',
			color_female:'#ff426e',
		};

	    //自定义颜色
	    slider.render({
	        elem: '#sliderw'
	        ,theme: '#1E9FFF' //主题色
	        ,step:10,
	        min:400,
	        max:2000,
	        value:800,
	        change: function(value){
			    width = value;
			    console.log(width);
			    $("#main").css('width', width);
    			setPriW(width);
			  }
	    });
	    slider.render({
	        elem: '#sliderh'
	        ,theme: '#1E9FFF' //主题色
	        ,step:10,
	        min:400,
	        max:2000,
	        value:800,
	        change: function(value){
			    height = value;
			    console.log(height);
			    $("#main").css('height', height);
			    setPriH(height);
			  }
	    });
	    slider.render({
	        elem: '#slidero'
	        ,theme: '#1E9FFF' //主题色
	        ,step:1,
	        min:0,
	        max:100,
	        value:70,
	        change: function(value){
			    console.log(value);
			    obj.area_opacity = value / 100;
				setPri(obj);
			  }
	    });
	    slider.render({
	        elem: '#slideryaxis'
	        ,theme: '#1E9FFF' //主题色
	        ,step:1,
	        min:0,
	        max:10,
	        value:5,
	        change: function(value){
			    console.log(value);
			    obj.axisTick_length = value;
				setPri(obj);
			  }
	    });
	    colorpicker.render({
	        elem: '#color1'
	        ,color:'#20b7a9'
	        ,format:'hex'
	        ,alpha:1,
	        size:'xs',
	        change: function(value){
			    console.log(value);
			    obj.color_male = value;
			    setPri(obj);
			  }
	    });
	    colorpicker.render({
	        elem: '#color2'
	        ,color:'#ff426e'
	        ,format:'hex'
	        ,alpha:1,
	        size:'xs',
	        change: function(value){
			    console.log(value);
			    obj.color_female = value;
			    setPri(obj);
			  }
	    });
	    var uploadInst = upload.render({
		    elem: '#uploadBtn' //绑定元素
		    ,url: '/upload/' //上传接口
		    ,accept: 'file' 
		    ,acceptMime: 'xlsx' 
		    ,exts: 'xlsx|xls' 
		    ,auto: true 
		    ,size: 20000 
		    ,drag: true
		    ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
			    layer.load(); //上传loading
			}
		    ,done: function(res){
		      //上传完毕回调
		      layer.closeAll('loading'); //关闭loading
		      console.log(res);
		    }
		    ,error: function(){
		      //请求异常回调
		      layer.closeAll('loading'); //关闭loading
		    }
		  });
	    form.on('click', '#reset', function(event) {
	    	alert("message?: DOMString")
	    });
	    form.on('radio(gtype)', function(data){
		  console.log(data.value); //被点击的radio的value值
		  obj.gtype = data.value;
		  setPri(obj);
		});
		form.on('switch(switch-smooth)', function(data){
		  console.log(data.elem.checked); //开关是否开启，true或者false
		  obj.smooth = data.elem.checked;
		  setPri(obj);
		});
		form.on('switch(switch-label)', function(data){
		  console.log(data.elem.checked); //开关是否开启，true或者false
		  obj.label = data.elem.checked;
		  setPri(obj);
		});
	    form.on('submit(ok)', function(data){
		  console.log(data.field); //当前容器的全部表单字段，名值对形式：{name: value}
		  setPri(data.field);
		  return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
		});
	});
		// setPri();
		var obj = {
			width:600,
			height:400,
			title:"标题",
			subtitle:"副标题",
			sublink:"副标题链接",
			gtype:"bar",
			smooth:true,
			label:true,
			area_opacity:0.7,
			axisTick_length:5,
			color_male:'#20b7a9',
			color_female:'#ff426e',
		};
		
        setPri(obj);

        
	});
	
</script>
</body>
</html>
